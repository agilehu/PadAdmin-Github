<% provide(:title, '产品展示')  %>
<%= form_for(@product) do |f| %>

      <% if @product.errors.any? %>
          <div id="error_explanation">
          <h2><%= pluralize(@product.errors.count, "error") %> prohibited this product from being saved:</h2>
          <ul>
              <% @product.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
          </div>
      <% end %>
        <div class="field">
            <label>产品名字:</label>
          <%= f.text_field :product_name,class:"form-control",type:"text" %>
        </div>
        <div class="field">
        <%= javascript_include_tag 'plugins/ueditor/ueditor.config', 'data-turbolinks-track' => true %>
        <%= javascript_include_tag 'plugins/ueditor/ueditor.all.min', 'data-turbolinks-track' => true %>
         <label>产品描述:</label>
        <script id="editor" type="text/plain" style="width:1010px; height:500px;"></script>
        </div>
        <%= javascript_include_tag 'plugins/ueditor/ueditor','data-turbolinks-track' => true %>   
       <!-- <div class="actions">
        <%= f.submit "提交", class:"btn btn-outline btn-primary "%>
      </div>-->
      <div class="field">
      </div>
<% end %>
<button id="edit_button" class="btn btn-outline btn-primary">提交</button>

 <script type="text/javascript">

    var formdata = new FormData();
    formdata.append($("#product_product_name").attr("name"),$("#product_product_name").attr("value"));
    formdata.append("authenticity_token",$("authenticity_token").attr("value"));
    formdata.append("utf8",$("utf8").attr("value"));
    formdata.append("product[context]",$("#ueditor_0").context);
    console.log($("#ueditor_0").context);
    $("#edit_button").click(function () {
                // $.post('/products/3',{
                //   "product[context]" :"fadf",
                //   "product[product_name]" :"1231313",
                //   "authenticity_token" :"c2BkLHLyLy8Mqjfsc/JwMruo4mLYS7BoQgl65qdqFJY=",
                //   "utf8":"&#x2713;"
                // }, function(data, textStatus, xhr) {
                //   console.log(textStatus+formdata)
                // });

                $.ajax({
                  url: '/products/3',
                  dataType: "json",
                  type: 'put',
                  data: {
                    // product{
                    //   product_name : $("#product_product_name").val(),
                    //   context : UE.getEditor('editor').getAllHtml()
                    // },
                    // authenticity_token : "c2BkLHLyLy8Mqjfsc/JwMruo4mLYS7BoQgl65qdqFJY=",
                    "product[product_name]" :$("#product_product_name").val(),
                    "product[context]" : UE.getEditor('editor').getAllHtml(),
                    "authenticity_token" : "c2BkLHLyLy8Mqjfsc/JwMruo4mLYS7BoQgl65qdqFJY=",
                    "utf8":"&#x2713;"
                  },
                })
                .done(function( data) {
                  console.log( "done: " + jQuery.parseJSON(data));
                })
                .fail(function ( jqXHR, textStatus, errorThrown ) {
                    console.log(jqXHR);
                    console.log(textStatus);
                    console.log(errorThrown);
                })
                .always(function( data ) {
                  console.log( "always: " +data );
                })
                
            });
</script>